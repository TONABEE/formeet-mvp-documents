# Formeet 画面遷移図

## 作成日: 2025年9月30日
## 対象: Formeet 認知特性対応型ライフマネジメントアプリ MVP版

---

## 画面遷移全体図

```
[スプラッシュ画面] 
    ↓
[オンボーディング画面群]
    ↓
[初期アセスメント・設定フロー]
    ↓
┌─[基本設定]─────────────────┐    ┌─[既存ユーザー]───────┐
│ [名前・起床就寝時間設定]     │    │ [OAuth認証]          │
│    ↓                        │    │    ↓                │
│ [場所登録（自宅・職場）]     │    │ [メイン画面へ]       │
│    ↓                        │    └─────────────────────┘
│ [ルーティン設定画面]         │
│    ↓                        │
│ [認知特性アンケート]         │
│    ↓                        │
│ [位置情報許可]               │
│    ↓                        │
│ [設定完了画面]               │
└─────────────────────────────┘
    ↓
[メイン画面（時間帯適応型）]
    ↓
┌─[ルーティンモード]──┬─[通常モード]──────┬─[デイリープランニング]─┐
│ (起床前後・就寝前後) │ (8:00-22:00)      │ (朝8:00-10:00強制)     │
│                      │                    │                        │
│ [朝ルーティン]       │ [今日のフォーカス] │ [タスク配置画面]       │
│ - 洗顔・歯磨き       │ - 現在実行中       │ - ドラッグ&ドロップ    │
│ - 着替え             │ - 次の予定         │ - AI自動配置           │
│ - 朝食               │ - 移動アラート     │ - 配置必須化           │
│    ↓                 │    ↓               │    ↓                   │
│ [夜ルーティン]       │ [タスク管理]       │ [計画確定]             │
│ - 入浴               │ - Notionライク     │    ↓                   │
│ - スキンケア         │ - プロジェクト色   │ [通常モードへ]         │
│ - 明日準備           │ - フィルター       │                        │
└──────────────────────┴────────────────────┴────────────────────────┘
```

---

## 詳細画面遷移

### 1. アプリ起動〜初期設定フロー

#### 1.1 初回起動時
```
[スプラッシュ画面] (3秒)
    ↓
[オンボーディング1] ← → [オンボーディング2] ← → [オンボーディング3]
  「認知特性について」    「アプリの使い方」      「プライバシー保護」
    ↓ (スキップ不可・重要)
[初期設定フロー開始]
    ↓
┌─[新規ユーザー設定]──────────────┐    ┌─[既存ユーザー]─────┐
│ [基本情報入力画面]               │    │ [OAuth認証画面]    │
│   - 名前入力                     │    │   - Google/Apple   │
│   - 起床時間設定（例：7:00）     │    │   - 自動ログイン   │
│   - 就寝時間設定（例：23:00）    │    │    ↓             │
│   - 「次へ」                     │    │ [メイン画面へ]     │
│    ↓                            │    └───────────────────┘
│ [場所登録画面]                   │
│   - 自宅住所入力/地図選択        │
│   - 職場・学校住所入力           │
│   - よく行く場所（最大3箇所）    │
│   - 「次へ」                     │
│    ↓                            │
│ [ルーティン設定画面]             │
│   - 朝のルーティン設定           │
│     ✓ 洗顔・歯磨き（5分）       │
│     ✓ 着替え（10分）            │
│     ✓ 朝食（20分）              │
│   - 夜のルーティン設定           │
│     ✓ 入浴（30分）              │
│     ✓ スキンケア（10分）        │
│     ✓ 明日の準備（15分）        │
│   - 「次へ」                     │
│    ↓                            │
│ [認知特性アンケート画面]         │
│   - 10問の簡単な質問             │
│   - 時間感覚チェック             │
│   - 得意/苦手分野判定            │
│   - 「次へ」                     │
│    ↓                            │
│ [位置情報許可画面]               │
│   - GPS機能の説明                │
│   - 移動時間算出の重要性         │
│   - プライバシー保護について     │
│   - 「許可する」「後で設定」     │
│    ↓                            │
│ [設定完了画面]                   │
│   - 「設定完了！」メッセージ     │
│   - 初回プランニングへの案内     │
│   - 「Formeetを始める」          │
└─────────────────────────────────┘
    ↓
[メイン画面へ]
```

#### 1.2 既存ユーザー
```
[スプラッシュ画面] (3秒)
    ↓ (自動ログイン成功)
[時間帯判定] → [適切なメイン画面表示]

[スプラッシュ画面] (3秒)
    ↓ (自動ログイン失敗)
[OAuth認証画面]
```

### 2. メイン画面（時間帯適応型）

#### 2.1 ルーティンモード（起床前後・就寝前後1時間）
```
[ルーティンモード画面]
├─ 「おはよう/おやすみ」メッセージ
├─ 現在時刻・ルーティン進捗バー
├─ ルーティンタスクのみ表示（他は非表示）
│   ├─ □ 洗顔・歯磨き（5分）
│   ├─ □ 着替え（10分）  
│   └─ □ 朝食（20分）
├─ 大きなチェックボックス（40×40px）
├─ 24pxの大きなフォント
└─ 各タスクタップ
    ↓
[ルーティンタスク実行画面]
├─ タスク名（特大表示）
├─ 目安時間表示
├─ シンプルタイマー
├─ 「完了」ボタン（大）
└─ 完了時
    ↓
[ルーティン進捗更新] → [次のタスクまたはメイン画面]

[朝ルーティン完了時] → [デイリープランニング強制フロー]
[夜ルーティン完了時] → [就寝記録] → [お疲れ様画面]
```

#### 2.2 デイリープランニングモード（朝8:00-10:00強制）
```
[デイリープランニング画面]
├─ 「今日の計画を立てましょう」タイトル
├─ 2ペインレイアウト
│   ├─ 左：未配置タスクリスト
│   │   ├─ プロジェクト色付きカード
│   │   ├─ 優先度★表示
│   │   ├─ 予測時間表示
│   │   └─ ドラッグハンドル
│   └─ 右：今日のタイムライン
│       ├─ 固定ブロック（睡眠・予定・移動）
│       └─ 配置可能エリア（点線表示）
├─ [AI自動配置]ボタン
├─ [計画確定]ボタン（全タスク配置まで無効）
└─ ドラッグ&ドロップ操作
    ↓ (タスクドラッグ時)
[リアルタイム配置プレビュー]
├─ 配置可能エリアのハイライト
├─ 時間の自動調整表示
└─ ドロップ時
    ↓
[タスク配置完了] → [次のタスク配置 or 計画確定]

[計画確定]タップ時
    ↓ (全タスク配置済み)
[プランニング完了画面] → [通常モードへ遷移]
    ↓ (未配置タスクあり)
[「全てのタスクを配置してください」警告]
```

#### 2.3 通常モード（8:00-22:00）
```
[今日のフォーカス画面]
├─ 現在時刻（大表示）
├─ 達成率バー
├─ 現在のブロック（大表示）
│   ├─ 実行中タスク/予定名
│   ├─ 残り時間・進捗バー
│   └─ [完了][一時停止]ボタン
├─ 次の予定（30分以内に表示）
│   ├─ 移動アラート付き
│   └─ 準備開始通知
├─ 今日のタスクリスト（簡略版）
└─ メニューアクセス
    ↓
[タスク実行画面] (タスク開始時)
├─ タスク名（特大表示）
├─ プロジェクト色背景
├─ タイマー（経過・予定・進捗バー）
├─ 位置情報ステータス
├─ [一時停止][完了][中断]ボタン
└─ 完了時
    ↓
[タスク完了画面] → [次のタスク提案] → [メイン画面]
```

#### 2.4 サブ画面群（メイン画面からアクセス）
```
[タスク管理画面] (Notionライクビュー)
├─ ビュー切替タブ
│   ├─ テーブルビュー
│   ├─ カンバンビュー  
│   ├─ カレンダービュー
│   └─ ガントチャート（Phase 2）
├─ フィルター機能
│   ├─ 今日のタスク
│   ├─ プロジェクト選択（複数可）
│   ├─ 優先度（★★★/★★/★）
│   └─ ステータス
├─ タスク作成・編集
│   ├─ タイトル入力
│   ├─ プロジェクト選択
│   ├─ 優先度設定
│   ├─ 予定時間入力
│   └─ 期限設定
└─ プロジェクト管理
    ↓
[プロジェクト設定画面]
├─ プロジェクト一覧
├─ カラーピッカー（10色）
├─ アイコン選択
├─ [新規プロジェクト作成]
└─ デフォルト設定

[スケジュール管理画面] (統合カレンダー)
├─ 表示切替（日/週/月）
├─ タイムライングリッド（0-24時）
├─ 4層レイヤー表示
│   ├─ 睡眠ブロック（薄紫）
│   ├─ 予定ブロック（青/緑）
│   ├─ 移動ブロック（グレー固定）
│   └─ タスクブロック（プロジェクト色）
├─ 現在時刻ライン（赤）
└─ 予定追加・編集
    ↓
[予定追加画面]
├─ タイトル・日時入力
├─ 場所設定（対面/オンライン/ハイブリッド）
├─ 移動時間自動算出ON/OFF
├─ 準備時間・バッファ時間設定
└─ [保存]

[デイリーレビュー画面] (夜ルーティン後)
├─ 1日の振り返り
├─ 睡眠分析（就寝・起床時刻）
├─ 移動分析（総移動時間・予測vs実績）
├─ タスク達成（完了率・プロジェクト別実績）
├─ 時間配分（円グラフ・プロジェクト色）
├─ 簡易振り返り入力（選択式）
└─ 明日への改善提案
```

### 3. 特殊画面・フロー

#### 3.1 移動・GPS関連画面
```
[移動開始アラート画面]
├─ 「〇〇への移動時間です」
├─ 現在地・目的地表示
├─ 予測移動時間・推奨出発時刻
├─ [出発する][10分後に通知]
└─ GPS追跡開始

[移動中画面]
├─ リアルタイム位置表示
├─ 到着予定時刻
├─ 遅れている場合の警告
├─ [到着報告]ボタン
└─ 自動到着検知

[位置情報権限要求画面]
├─ 「移動時間を正確に計算するため」説明
├─ GPS機能の重要性説明
├─ プライバシー保護について
├─ 「許可する」「手動で管理する」
└─ 設定アプリへの遷移案内
```

#### 3.2 緊急・エラー対応画面
```
[パニックボタン画面] (将来機能)
├─ 「今何をすべきか分からない」状況
├─ 深呼吸アニメーション
├─ 現在地・時間から最優先タスク1つ提示
├─ [これをやる][まず休憩]
└─ 簡易サポート連絡

[ネットワークエラー画面]
├─ 「オフラインモードで動作中」
├─ 保存されたデータでの継続利用
├─ [再接続を試す]ボタン
└─ 接続復旧時の自動同期

[GPS精度エラー画面]
├─ 「位置情報の精度が低下中」
├─ WiFi/Bluetooth有効化の提案
├─ 手動での移動時間入力オプション
└─ [設定を確認]
```

### 4. 設定・管理画面
```
[設定画面]
├─ アカウント情報
├─ ルーティン設定
├─ 通知設定（移動・タスク・リマインダー）
├─ プライバシー設定
├─ データエクスポート
├─ ヘルプ・サポート
└─ ログアウト

[ヘルプ・サポート画面]
├─ よくある質問
├─ 使い方ガイド
├─ 認知特性について
├─ お問い合わせフォーム
└─ コミュニティリンク（将来）
```

---

## 画面遷移ルール

### 遷移パターン
1. **Push遷移**: 詳細画面、設定画面など
2. **Modal遷移**: 一時的な操作、確認画面など
3. **Tab切り替え**: メインコンテンツ間の移動
4. **Replace遷移**: ログイン後のメイン画面表示

### 戻る操作
- **ナビゲーションバー**: 「戻る」ボタン
- **ジェスチャー**: スワイプバック（iOS）
- **ハードウェアボタン**: 端末の戻るボタン（Android）

### 深いリンク対応
- 特定タスク直接アクセス
- 特定日のスケジュール表示
- 緊急時のパニックボタン直アクセス

---

## 画面状態管理

### 時間帯別モード管理
- **6:00-8:00**: 朝ルーティンモード（強制）
- **8:00-10:00**: デイリープランニング（初回のみ強制）
- **10:00-22:00**: 通常モード
- **22:00-24:00**: 夜ルーティンモード（強制）
- **24:00-6:00**: 睡眠モード（アプリ使用制限）

### 認証・ログイン状態
- **未認証**: OAuth認証フロー表示
- **初回ユーザー**: 初期設定フロー必須
- **既存ユーザー**: 時間帯判定→適切な画面表示
- **セッション切れ**: 自動再認証

### GPS・位置情報状態
- **未許可**: 手動入力モード（機能制限あり）
- **許可済み**: フル機能利用可能
- **精度低下**: 警告表示・代替手段提案
- **オフライン**: キャッシュデータ使用

### データ同期状態
- **オンライン**: リアルタイム同期
- **オフライン**: ローカルキャッシュ動作
- **復旧時**: 自動データ同期・競合解決
- **同期エラー**: ユーザーへの通知・手動解決オプション

---

**更新履歴:**
- 2025年9月30日: 初版作成
- 定期見直し: 開発進捗に応じて更新